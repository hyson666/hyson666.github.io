<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="Hyson" />



<meta name="description" content="题目连接

http://poj.org/problem?id=3592
Description

It was long ago when we played the game Red Alert. There is a magic function for the game objects which is called instantaneous transfer. When an obje">
<meta property="og:type" content="article">
<meta property="og:title" content="POJ3592 Instantaneous Transference - Tarjan缩点+DP">
<meta property="og:url" content="http://yoursite.com/2017/04/20/POJ3592/index.html">
<meta property="og:site_name" content="HysonQAQ">
<meta property="og:description" content="题目连接

http://poj.org/problem?id=3592
Description

It was long ago when we played the game Red Alert. There is a magic function for the game objects which is called instantaneous transfer. When an obje">
<meta property="og:updated_time" content="2017-04-20T06:14:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="POJ3592 Instantaneous Transference - Tarjan缩点+DP">
<meta name="twitter:description" content="题目连接

http://poj.org/problem?id=3592
Description

It was long ago when we played the game Red Alert. There is a magic function for the game objects which is called instantaneous transfer. When an obje">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="HysonQAQ" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>POJ3592 Instantaneous Transference - Tarjan缩点+DP | HysonQAQ</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Hyson</a></h1>
        </hgroup>

        
        <p class="header-subtitle">很卑微，不努力。</p>
        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/categories/算法/">算法</a></li>
                        
                            <li><a href="/categories/随笔/">随笔</a></li>
                        
                            <li><a href="/关于Hyson/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:601852941@qq.com" title="Email"></a>
                            
                                <a class="fa 新浪微博" href="http://weibo.com/h1son" title="新浪微博"></a>
                            
                                <a class="fa GitHub" href="https://github.com/hyson666" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa 网易云音乐" href="http://music.163.com/#/user/home?id=290679779" title="网易云音乐"></a>
                            
                                <a class="fa QQ" href="tencent://message/?uin=601852941&Site=www.hitux.com&Menu=yes" title="QQ"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="/">friends</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">合肥工业大学在读Acmer</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Hyson</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Hyson</a></h1>
            </hgroup>
            
            <p class="header-subtitle">很卑微，不努力。</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/categories/算法/">算法</a></li>
                
                    <li><a href="/categories/随笔/">随笔</a></li>
                
                    <li><a href="/关于Hyson/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:601852941@qq.com" title="Email"></a>
                            
                                <a class="fa 新浪微博" target="_blank" href="http://weibo.com/h1son" title="新浪微博"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/hyson666" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa 网易云音乐" target="_blank" href="http://music.163.com/#/user/home?id=290679779" title="网易云音乐"></a>
                            
                                <a class="fa QQ" target="_blank" href="tencent://message/?uin=601852941&Site=www.hitux.com&Menu=yes" title="QQ"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-POJ3592" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/04/20/POJ3592/" class="article-date">
      <time datetime="2017-04-20T04:39:47.000Z" itemprop="datePublished">2017-04-20</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      POJ3592 Instantaneous Transference - Tarjan缩点+DP
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/图论-Tarjan/">图论 Tarjan</a>
    </div>


        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <font size="4">题目连接</font>

<p><a href="http://poj.org/problem?id=3592" target="_blank" rel="external">http://poj.org/problem?id=3592</a></p>
<font size="4">Description</font>

<p>It was long ago when we played the game Red Alert. There is a magic function for the game objects which is called instantaneous transfer. When an object uses this magic function, it will be transferred to the specified point immediately, regardless of how far it is.</p>
<p>Now there is a mining area, and you are driving an ore-miner truck. Your mission is to take the maximum ores in the field.</p>
<p>The ore area is a rectangle region which is composed by n × m small squares, some of the squares have numbers of ores, while some do not. The ores can’t be regenerated after taken.</p>
<p>The starting position of the ore-miner truck is the northwest corner of the field. It must move to the eastern or southern adjacent square, while it can not move to the northern or western adjacent square. And some squares have magic power that can instantaneously transfer the truck to a certain square specified. However, as the captain of the ore-miner truck, you can decide whether to use this magic power or to stay still. One magic power square will never lose its magic power; you can use the magic power whenever you get there.</p>
<font size="4">Input</font>

<p>The first line of the input is an integer T which indicates the number of test cases.</p>
<p>For each of the test case, the first will be two integers N, M (2 ≤ N, M ≤ 40).</p>
<p>The next N lines will describe the map of the mine field. Each of the N lines will be a string that contains M characters. Each character will be an integer X (0 ≤ X ≤ 9) or a ‘<em>‘ or a ‘#’. The integer X indicates that square has X units of ores, which your truck could get them all. The ‘</em>‘ indicates this square has a magic power which can transfer truck within an instant. The ‘#’ indicates this square is full of rock and the truck can’t move on this square. You can assume that the starting position of the truck will never be a ‘#’ square.</p>
<p>As the map indicates, there are K ‘*‘ on the map. Then there follows K lines after the map. The next K lines describe the specified target coordinates for the squares with ‘*‘, in the order from north to south then west to east. (the original point is the northwest corner, the coordinate is formatted as north-south, west-east, all from 0 to N - 1,M - 1).</p>
<font size="4">Output</font>

<p>For each test case output the maximum units of ores you can take. 　</p>
<p>Sample Input</p>
<p>1<br>2 2<br>11<br>1*<br>0 0<br>Sample Output</p>
<p>3</p>
<p><strong>题意</strong></p>
<p>采矿车只能向右或者向下移动，在传送点的时候可以进行瞬间移动到地图上的某一点，传送点可以用无数次，并且采矿车不能进入到山区，问你最大采矿量是多少。</p>
<p><strong>题解</strong></p>
<p>开始的时候以为矿车不会被传送到山区，连边的时候就没有多想什么，给山区也连了出边WA了一发，果然还是太年轻。</p>
<p>建边有两种可行的方式：</p>
<p>1.对点跑DFS跑到的点全部与DFS起点连单向边（只能右、下移动），连过边的做标记，最后给传送点连边即可。</p>
<p>2.N^连边，枚举每个点可走的点直接连边即可。</p>
<p>首先将地图染色，标记不同的连通分量，每个分量的矿产总量作为缩点后SCC图的权，而且由于传送无限次，必定可以都采完。那么现在只有对SCC图跑一次最大权路就可以了。题目没有规定终点，而且SCC图是简单无环图（DAG），所以我们只要重新建图后跑一边记忆化搜索记录根（起点所在的连通分量）到叶子结点路劲的权值和，DP出最大值就可以了。</p>
<p><strong>代码：</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">2500</span>+<span class="number">10</span>;</div><div class="line"><span class="keyword">int</span> id,n,m,G[<span class="number">45</span>][<span class="number">45</span>],head[maxn],transnum[maxn],iid,hhead[maxn];</div><div class="line"><span class="keyword">int</span> dfn[maxn],low[maxn],flag[maxn],tot,vis[maxn],tag,w[maxn],dp[maxn];</div><div class="line"><span class="keyword">int</span> dx[<span class="number">2</span>]=&#123;<span class="number">1</span>,<span class="number">0</span>&#125;,dy[<span class="number">2</span>]=&#123;<span class="number">0</span>,<span class="number">1</span>&#125;;</div><div class="line"><span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; S;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> Edge&#123;</div><div class="line">    <span class="keyword">int</span> from,next,to;</div><div class="line">&#125;E[maxn&lt;&lt;<span class="number">2</span>],e[maxn&lt;&lt;<span class="number">2</span>];</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</div><div class="line">    id=<span class="number">0</span>,tag=<span class="number">0</span>,tot=<span class="number">0</span>,iid=<span class="number">0</span>;</div><div class="line">    <span class="built_in">memset</span>(dfn,<span class="number">0</span>,<span class="keyword">sizeof</span> dfn);</div><div class="line">    <span class="built_in">memset</span>(low,<span class="number">0</span>,<span class="keyword">sizeof</span> low);</div><div class="line">    <span class="built_in">memset</span>(head,<span class="number">-1</span>,<span class="keyword">sizeof</span> head);</div><div class="line">    <span class="built_in">memset</span>(hhead,<span class="number">-1</span>,<span class="keyword">sizeof</span> hhead);</div><div class="line">    <span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="keyword">sizeof</span> vis);</div><div class="line">    <span class="built_in">memset</span>(flag,<span class="number">0</span>,<span class="keyword">sizeof</span> flag);</div><div class="line">    <span class="built_in">memset</span>(transnum,<span class="number">0</span>,<span class="keyword">sizeof</span> transnum);</div><div class="line">    <span class="built_in">memset</span>(w,<span class="number">0</span>,<span class="keyword">sizeof</span> w);</div><div class="line">    <span class="built_in">memset</span>(G,<span class="number">0</span>,<span class="keyword">sizeof</span> G);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">point</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> x*m + y;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">judge</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> x&gt;=<span class="number">0</span> &amp;&amp; x&lt;n &amp;&amp; y&gt;=<span class="number">0</span> &amp;&amp; y&lt;m &amp;&amp; G[x][y]!=<span class="number">-1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">    E[id].from=u;</div><div class="line">    E[id].to=v;</div><div class="line">    E[id].next=head[u];</div><div class="line">    head[u]=id++;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge2</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">    e[iid].from=u;</div><div class="line">    e[iid].to=v;</div><div class="line">    e[iid].next=hhead[u];</div><div class="line">    hhead[u]=iid++;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">askw</span><span class="params">(<span class="keyword">int</span> num)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> y = num % m ;</div><div class="line">    <span class="keyword">int</span> x = (num-y)/m ;</div><div class="line">    <span class="keyword">if</span>(G[x][y]&gt;<span class="number">0</span>)</div><div class="line">        <span class="keyword">return</span> G[x][y];</div><div class="line">    <span class="keyword">else</span></div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">tarjan</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">    dfn[x] = low[x] = ++tot;</div><div class="line">    vis[x] = <span class="number">1</span>;</div><div class="line">    S.push(x);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=head[x];i!=<span class="number">-1</span>;i=E[i].next)&#123;</div><div class="line">        <span class="keyword">int</span> v=E[i].to;</div><div class="line">        <span class="keyword">if</span>(!dfn[v]) &#123;</div><div class="line">            tarjan(v);</div><div class="line">            low[x] = min(low[x], low[v]);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(vis[v])</div><div class="line">            low[x]=min(low[x],dfn[v]);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(dfn[x]==low[x])&#123;</div><div class="line">        ++tag;</div><div class="line">        <span class="keyword">while</span>(<span class="number">1</span>)&#123;</div><div class="line">            <span class="keyword">int</span> now=S.top();</div><div class="line">            S.pop();</div><div class="line">            vis[now]=<span class="number">0</span>;</div><div class="line">            flag[now]=tag;</div><div class="line">            w[tag] += askw(now);</div><div class="line">            <span class="keyword">if</span>(now == x) <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//记忆化DFS跑最短路用的</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(dp[x]&gt;<span class="number">-1</span>)</div><div class="line">        <span class="keyword">return</span> dp[x];</div><div class="line">    dp[x]=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=hhead[x];i!=<span class="number">-1</span>;i=e[i].next)</div><div class="line">        dp[x]=max(dp[x],dfs(e[i].to));</div><div class="line">    dp[x]+=w[x];</div><div class="line">    <span class="keyword">return</span> dp[x];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> v;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;v);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> cas=<span class="number">0</span>;cas&lt;v;++cas)&#123;</div><div class="line">        init();</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</div><div class="line">        <span class="keyword">char</span> temp[maxn];</div><div class="line">        <span class="keyword">int</span> num,transcnt=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;++i)&#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%s\n"</span>,temp);</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;m;++j)&#123;</div><div class="line">                <span class="keyword">if</span>(temp[j]==<span class="string">'#'</span>)</div><div class="line">                    G[i][j]=<span class="number">-1</span>;</div><div class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(temp[j] == <span class="string">'*'</span>)&#123;</div><div class="line">                    transcnt++;</div><div class="line">                    G[i][j]=<span class="number">0</span>;</div><div class="line">                    transnum[transcnt]=point(i,j);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">else</span>&#123;</div><div class="line">                    num=temp[j]-<span class="string">'0'</span>;</div><div class="line">                    G[i][j]=num;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//建立图内连通。</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> x=<span class="number">0</span>;x&lt;n;++x)</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> y=<span class="number">0</span>;y&lt;m;++y) &#123;</div><div class="line">                <span class="keyword">if</span>(G[x][y]!=<span class="number">-1</span>) &#123;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">2</span>; ++k) &#123;</div><div class="line">                        <span class="keyword">int</span> tx = x + dx[k], ty = y + dy[k];</div><div class="line">                        <span class="keyword">if</span> (judge(tx, ty) &amp;&amp; G[tx][ty] != <span class="number">-1</span>) &#123;</div><div class="line">                            addEdge(point(x, y), point(tx, ty));</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        <span class="comment">//建立传送门。</span></div><div class="line">        <span class="keyword">int</span> u,r,pnum;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=transcnt;++i)&#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;u,&amp;r);</div><div class="line">            pnum = point(u,r);</div><div class="line">            addEdge(transnum[i],pnum);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> total = maxn;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;maxn;++i)</div><div class="line">            <span class="keyword">if</span>(!dfn[i])</div><div class="line">                tarjan(i);</div><div class="line">        <span class="comment">//建立缩点图跑最长路用。</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;id;++i)&#123;</div><div class="line">            u = flag[E[i].from],r=flag[E[i].to];</div><div class="line">            <span class="keyword">if</span>(u!=r)</div><div class="line">                addEdge2(u,r);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//记忆化DFS跑DAG最短路（DP）。</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=tag;++i)</div><div class="line">            dp[i]=<span class="number">-1</span>;</div><div class="line">        <span class="keyword">int</span> ans = dfs(flag[<span class="number">0</span>]);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2017/04/20/POJ3592/">POJ3592 Instantaneous Transference - Tarjan缩点+DP</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">Hyson</a></p>
        <p><span>发布时间:</span>2017-04-20, 12:39:47</p>
        <p><span>最后更新:</span>2017-04-20, 14:14:00</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2017/04/20/POJ3592/" title="POJ3592 Instantaneous Transference - Tarjan缩点+DP">http://yoursite.com/2017/04/20/POJ3592/</a>
            <span class="copy-path" data-clipboard-text="原文: http://yoursite.com/2017/04/20/POJ3592/　　作者: Hyson" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2017/04/20/POJ3114/">
                    POJ3114 Countries in War - Tarjan缩点+堆优化Dijkstra
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2017/04/20/POJ2186/">
                    POJ2186 Popular Cow - Tarjan染色缩点
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"POJ3592 Instantaneous Transference - Tarjan缩点+DP　| HysonQAQ　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    
      <div class="duoshuo" id="comments">
    <div id="comment-box" ></div>
    <div class="ds-thread" id="ds-thread" data-thread-key="2017/04/20/POJ3592/" data-title="POJ3592 Instantaneous Transference - Tarjan缩点+DP" data-url="http://yoursite.com/2017/04/20/POJ3592/"></div>
    <script>
        var duoshuoQuery = {short_name:"hyson"};
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            s.async = true; s.charset = 'UTF-8';
            (d.head || d.body).appendChild(s);
        }

        
    </script>
    
    <script> loadComment(); </script>

</div>
    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2017/04/20/POJ3114/" title="上一篇: POJ3114 Countries in War - Tarjan缩点+堆优化Dijkstra">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2017/04/20/POJ2186/" title="下一篇: POJ2186 Popular Cow - Tarjan染色缩点">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/04/20/POJ3114/">POJ3114 Countries in War - Tarjan缩点+堆优化Dijkstra</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/20/POJ3592/">POJ3592 Instantaneous Transference - Tarjan缩点+DP</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/20/POJ2186/">POJ2186 Popular Cow - Tarjan染色缩点</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/15/POJ3279/">POJ3279（位运算，枚举）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/11/StaircaseNim/">Nim博弈变式（一）阶梯博弈</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/07/POJ2505/">POJ2505 (简单博弈，二分，打表）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/05/Nim/">博弈论基础学习（一）Nim游戏</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/26/segtree/">线段树单点更新</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/24/Hello/">Hello, my friend</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2017 Hyson
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
             categories: ".article-category a, a.tag-list-link", 
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>